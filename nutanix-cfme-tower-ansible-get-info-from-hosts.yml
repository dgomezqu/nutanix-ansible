---

- name: Get some info from hosts
  hosts: localhost
  gather_facts: False
  connection: local
  vars:
    base_url: "https://{{ nutanix_server }}:9440/api/nutanix/v3"
    username: "{{ lookup('env', 'NUTANIX_USER') }}"
    password: "{{ lookup('env', 'NUTANIX_PASSWORD') }}"

  tasks:
    - name: Get hosts
      uri:
        url: "{{ base_url }}/hosts/list"
        validate_certs: no
        force_basic_auth: yes
        method: POST
        status_code: 200
        user: "{{ username }}"
        password: "{{ password }}"
        body_format: json
        return_content: yes
      register: hostinfo

    - name: Output info
      debug: msg="DEBUG {{ item.name }}"
        with_items: "{{ hostinfo.json.entities }}" 
